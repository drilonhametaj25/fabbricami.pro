(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[166],{8315:function(e,t,r){Promise.resolve().then(r.bind(r,8606))},8606:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var n=r(7437),i=r(2265),s=r(7648),a=r(3145),o=r(8614),l=r(521),c=r(8997),d=r(8930),u=r(2252),h=r(2449),m=r(172),p=r(3947),g=r(9116),f=r(4508);function x(){let{items:e,removeItem:t}=(0,m.Y)(),{addItem:r}=(0,p.x)(),[x,y]=(0,i.useState)([]),[w,v]=(0,i.useState)(!0),[b,j]=(0,i.useState)(new Set);(0,i.useEffect)(()=>{(async()=>{if(0===e.length){y([]),v(!1);return}try{let t=await g.hi.get("/shop/products",{ids:e.join(",")});t.success&&t.data&&y(t.data.items||[])}catch(e){console.error("Failed to fetch wishlist products:",e)}finally{v(!1)}})()},[e]);let N=async e=>{j(t=>new Set(t).add(e));try{await r(e,1)}finally{j(t=>{let r=new Set(t);return r.delete(e),r})}},k=e=>{t(e),y(t=>t.filter(t=>t.id!==e))};return w?(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("div",{className:"bg-surface-card rounded-2xl p-4 animate-pulse",children:[(0,n.jsx)("div",{className:"aspect-square bg-surface-raised rounded-lg mb-4"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"h-5 bg-surface-raised rounded w-3/4"}),(0,n.jsx)("div",{className:"h-4 bg-surface-raised rounded w-1/2"})]})]},t))}):(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsxs)("h2",{className:"font-display text-2xl font-semibold text-white",children:["Lista Desideri (",x.length,")"]})}),0===x.length?(0,n.jsxs)("div",{className:"bg-surface-card rounded-2xl p-8 text-center",children:[(0,n.jsx)(c.Z,{className:"w-16 h-16 text-text-muted mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"La tua lista desideri e vuota"}),(0,n.jsx)("p",{className:"text-text-secondary mb-6",children:"Salva i prodotti che ti piacciono per trovarli facilmente in seguito"}),(0,n.jsx)(s.default,{href:"/shop",className:"btn-primary btn-medium",children:"Esplora lo Shop"})]}):(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:(0,n.jsx)(o.M,{mode:"popLayout",children:x.map(e=>{var t;let r=e.onSale&&e.salePrice&&e.salePrice<e.price,i=r?Math.round((1-e.salePrice/e.price)*100):0,o=!1!==e.inStock;return(0,n.jsxs)(l.E.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9,x:-100},className:"bg-surface-card rounded-2xl overflow-hidden group",children:[(0,n.jsxs)(s.default,{href:"/product/".concat(e.slug),className:"block relative aspect-square bg-surface-raised",children:[e.imageUrl&&(0,n.jsx)(a.default,{src:e.imageUrl,alt:e.name,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-500"}),(0,n.jsxs)("div",{className:"absolute top-3 left-3 flex flex-col gap-2",children:[r&&(0,n.jsxs)("span",{className:"px-2 py-1 bg-error text-white text-xs font-medium rounded",children:["-",i,"%"]}),!o&&(0,n.jsx)("span",{className:"px-2 py-1 bg-gray-800 text-white text-xs font-medium rounded",children:"Esaurito"})]}),(0,n.jsx)("button",{onClick:t=>{t.preventDefault(),k(e.id)},className:"absolute top-3 right-3 w-9 h-9 rounded-full bg-surface-raised/80 backdrop-blur-sm flex items-center justify-center text-white hover:bg-error hover:text-white transition-colors","aria-label":"Remove from wishlist",children:(0,n.jsx)(d.Z,{className:"w-4 h-4"})})]}),(0,n.jsxs)("div",{className:"p-4",children:[(null===(t=e.categories)||void 0===t?void 0:t[0])&&(0,n.jsx)("p",{className:"text-xs text-gold mb-1",children:e.categories[0].name}),(0,n.jsx)(s.default,{href:"/product/".concat(e.slug),className:"font-medium text-white hover:text-gold transition-colors line-clamp-2 mb-2",children:e.name}),(0,n.jsxs)("div",{className:"flex items-baseline gap-2 mb-4",children:[(0,n.jsx)("span",{className:"text-lg font-semibold text-gold",children:(0,f.T4)(r?e.salePrice:e.price)}),r&&(0,n.jsx)("span",{className:"text-sm text-text-muted line-through",children:(0,f.T4)(e.price)})]}),!o&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-sm text-warning mb-4",children:[(0,n.jsx)(u.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{children:"Prodotto esaurito"})]}),(0,n.jsx)("button",{onClick:()=>N(e.id),disabled:!o||b.has(e.id),className:"w-full btn-primary btn-medium justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:b.has(e.id)?(0,n.jsx)("span",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,{className:"w-4 h-4"}),o?"Aggiungi al Carrello":"Non Disponibile"]})})]})]},e.id)})})})]})}},9116:function(e,t,r){"use strict";function n(e){localStorage.setItem("cart_session_id",e)}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{params:r,headers:n,...i}=t,s=e.startsWith("http")?e:"".concat("http://localhost:3000/api/v1").concat(e);if(r){let e=new URLSearchParams;Object.entries(r).forEach(t=>{let[r,n]=t;null!=n&&e.append(r,String(n))});let t=e.toString();t&&(s+="?".concat(t))}let a={"Content-Type":"application/json",...n},o=localStorage.getItem("cart_session_id");o&&(a["X-Session-Id"]=o);let l=localStorage.getItem("auth_token");l&&(a.Authorization="Bearer ".concat(l));let c=await fetch(s,{...i,headers:a});if(!c.ok)throw Error((await c.json().catch(()=>({}))).error||"API Error: ".concat(c.status));let d=await c.json();if(!d.success&&d.error)throw Error(d.error);return d.data}r.d(t,{hi:function(){return s},xr:function(){return n}});let s={get:(e,t)=>i(e,{method:"GET",params:t}),post:(e,t)=>i(e,{method:"POST",body:t?JSON.stringify(t):void 0}),put:(e,t)=>i(e,{method:"PUT",body:t?JSON.stringify(t):void 0}),patch:(e,t)=>i(e,{method:"PATCH",body:t?JSON.stringify(t):void 0}),delete:e=>i(e,{method:"DELETE"})}},4508:function(e,t,r){"use strict";r.d(t,{$Q:function(){return o},Jn:function(){return c},Ox:function(){return l},T4:function(){return a},cn:function(){return s},p6:function(){return d}});var n=r(1994),i=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.m6)((0,n.W)(t))}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"EUR",r="string"==typeof e?parseFloat(e):e;return new Intl.NumberFormat("it-IT",{style:"currency",currency:t}).format(r)}function o(e,t){return e<=0||t>=e?0:Math.round((e-t)/e*100)}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/images/placeholder.jpg";return e?"string"==typeof e?e:e.url||e.src||t:t}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{day:"numeric",month:"long",year:"numeric"},r="string"==typeof e?new Date(e):e;return new Intl.DateTimeFormat("it-IT",t).format(r)}},2252:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8997:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},2449:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]])},8930:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},3947:function(e,t,r){"use strict";r.d(t,{x:function(){return o}});var n=r(9625),i=r(6885),s=r(9116),a=r(4508);let o=(0,n.Ue)()((0,i.tJ)((e,t)=>({cart:null,loading:!1,error:null,sessionId:null,isDrawerOpen:!1,initSession:()=>{let r=t().sessionId;r||e({sessionId:r=(0,a.Ox)()}),(0,s.xr)(r)},fetchCart:async()=>{e({loading:!0,error:null});try{t().initSession();let r=await s.hi.get("/shop/cart");e({cart:r,loading:!1})}catch(t){e({error:t.message,loading:!1})}},addItem:async(r,n,i)=>{e({loading:!0,error:null});try{t().initSession();let a=await s.hi.post("/shop/cart/items",{productId:r,quantity:n,variantId:i});e({cart:a,loading:!1,isDrawerOpen:!0})}catch(t){throw e({error:t.message,loading:!1}),t}},updateQuantity:async(t,r)=>{e({loading:!0,error:null});try{let n=await s.hi.patch("/shop/cart/items/".concat(t),{quantity:r});e({cart:n,loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},removeItem:async t=>{e({loading:!0,error:null});try{let r=await s.hi.delete("/shop/cart/items/".concat(t));e({cart:r,loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},clearCart:async()=>{e({loading:!0,error:null});try{await s.hi.delete("/shop/cart"),e({cart:null,loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},applyCoupon:async t=>{e({loading:!0,error:null});try{let r=await s.hi.post("/shop/cart/coupon",{code:t});e({cart:r,loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},removeCoupon:async()=>{e({loading:!0,error:null});try{let t=await s.hi.delete("/shop/cart/coupon");e({cart:t,loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},setShippingAddress:async t=>{e({loading:!0,error:null});try{let r=await s.hi.put("/shop/cart/shipping-address",t);e({cart:r,loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},setShippingMethod:async t=>{e({loading:!0,error:null});try{let r=await s.hi.put("/shop/cart/shipping-method",{methodId:t});e({cart:r,loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},openDrawer:()=>e({isDrawerOpen:!0}),closeDrawer:()=>e({isDrawerOpen:!1}),toggleDrawer:()=>e(e=>({isDrawerOpen:!e.isDrawerOpen})),itemCount:()=>{let e=t().cart;return(null==e?void 0:e.items)?e.items.reduce((e,t)=>e+t.quantity,0):0},subtotal:()=>{var e;let r=t().cart;return null!==(e=null==r?void 0:r.subtotal)&&void 0!==e?e:0},total:()=>{var e;let r=t().cart;return null!==(e=null==r?void 0:r.total)&&void 0!==e?e:0},isEmpty:()=>{let e=t().cart;return!(null==e?void 0:e.items)||0===e.items.length}}),{name:"cart-storage",partialize:e=>({sessionId:e.sessionId})}))},172:function(e,t,r){"use strict";r.d(t,{Y:function(){return s}});var n=r(9625),i=r(9116);let s=(0,n.Ue)((e,t)=>({items:[],loading:!1,error:null,fetchWishlist:async()=>{e({loading:!0,error:null});try{let t=await i.hi.get("/shop/wishlist");e({items:t.items||[],loading:!1})}catch(t){e({error:t.message,loading:!1,items:[]})}},toggle:async(t,r)=>{e({loading:!0,error:null});try{let n=await i.hi.post("/shop/wishlist/toggle",{productId:t,variantId:r});e({items:n.items||[],loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},removeItem:async t=>{e({loading:!0,error:null});try{await i.hi.delete("/shop/wishlist/".concat(t)),e(e=>({items:e.items.filter(e=>e.id!==t),loading:!1}))}catch(t){throw e({error:t.message,loading:!1}),t}},clearWishlist:async()=>{e({loading:!0,error:null});try{await i.hi.delete("/shop/wishlist"),e({items:[],loading:!1})}catch(t){throw e({error:t.message,loading:!1}),t}},setRestockNotification:async(t,r)=>{e({loading:!0,error:null});try{let n=await i.hi.patch("/shop/wishlist/".concat(t,"/notify"),{notifyRestock:r});e(e=>({items:e.items.map(e=>e.id===t?{...e,notifyRestock:n.notifyRestock}:e),loading:!1}))}catch(t){throw e({error:t.message,loading:!1}),t}},count:()=>t().items.length,isEmpty:()=>0===t().items.length,isInWishlist:(e,r)=>t().items.some(t=>t.productId===e&&(r?t.variantId===r:!t.variantId))}))},8614:function(e,t,r){"use strict";r.d(t,{M:function(){return x}});var n=r(7437),i=r(2265),s=r(8881),a=r(3576),o=r(4252),l=r(5750);class c extends i.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d(e){let{children:t,isPresent:r}=e,s=(0,i.useId)(),a=(0,i.useRef)(null),o=(0,i.useRef)({width:0,height:0,top:0,left:0}),{nonce:d}=(0,i.useContext)(l._);return(0,i.useInsertionEffect)(()=>{let{width:e,height:t,top:n,left:i}=o.current;if(r||!a.current||!e||!t)return;a.current.dataset.motionPopId=s;let l=document.createElement("style");return d&&(l.nonce=d),document.head.appendChild(l),l.sheet&&l.sheet.insertRule('\n          [data-motion-pop-id="'.concat(s,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(n,"px !important;\n            left: ").concat(i,"px !important;\n          }\n        ")),()=>{document.head.removeChild(l)}},[r]),(0,n.jsx)(c,{isPresent:r,childRef:a,sizeRef:o,children:i.cloneElement(t,{ref:a})})}let u=e=>{let{children:t,initial:r,isPresent:s,onExitComplete:l,custom:c,presenceAffectsLayout:u,mode:m}=e,p=(0,a.h)(h),g=(0,i.useId)(),f=(0,i.useCallback)(e=>{for(let t of(p.set(e,!0),p.values()))if(!t)return;l&&l()},[p,l]),x=(0,i.useMemo)(()=>({id:g,initial:r,isPresent:s,custom:c,onExitComplete:f,register:e=>(p.set(e,!1),()=>p.delete(e))}),u?[Math.random(),f]:[s,f]);return(0,i.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[s]),i.useEffect(()=>{s||p.size||!l||l()},[s]),"popLayout"===m&&(t=(0,n.jsx)(d,{isPresent:s,children:t})),(0,n.jsx)(o.O.Provider,{value:x,children:t})};function h(){return new Map}var m=r(9637);let p=e=>e.key||"";function g(e){let t=[];return i.Children.forEach(e,e=>{(0,i.isValidElement)(e)&&t.push(e)}),t}var f=r(1534);let x=e=>{let{children:t,custom:r,initial:o=!0,onExitComplete:l,presenceAffectsLayout:c=!0,mode:d="sync",propagate:h=!1}=e,[x,y]=(0,m.oO)(h),w=(0,i.useMemo)(()=>g(t),[t]),v=h&&!x?[]:w.map(p),b=(0,i.useRef)(!0),j=(0,i.useRef)(w),N=(0,a.h)(()=>new Map),[k,S]=(0,i.useState)(w),[E,I]=(0,i.useState)(w);(0,f.L)(()=>{b.current=!1,j.current=w;for(let e=0;e<E.length;e++){let t=p(E[e]);v.includes(t)?N.delete(t):!0!==N.get(t)&&N.set(t,!1)}},[E,v.length,v.join("-")]);let C=[];if(w!==k){let e=[...w];for(let t=0;t<E.length;t++){let r=E[t],n=p(r);v.includes(n)||(e.splice(t,0,r),C.push(r))}"wait"===d&&C.length&&(e=C),I(g(e)),S(w);return}let{forceRender:M}=(0,i.useContext)(s.p);return(0,n.jsx)(n.Fragment,{children:E.map(e=>{let t=p(e),i=(!h||!!x)&&(w===E||v.includes(t));return(0,n.jsx)(u,{isPresent:i,initial:(!b.current||!!o)&&void 0,custom:i?void 0:r,presenceAffectsLayout:c,mode:d,onExitComplete:i?void 0:()=>{if(!N.has(t))return;N.set(t,!0);let e=!0;N.forEach(t=>{t||(e=!1)}),e&&(null==M||M(),I(j.current),h&&(null==y||y()),l&&l())},children:e},t)})})}}},function(e){e.O(0,[972,230,312,883,971,117,744],function(){return e(e.s=8315)}),_N_E=e.O()}]);